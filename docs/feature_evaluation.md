# 特徴量実装実績と効果評価

作成日: 2026-02-26

---

## 評価方法

- モデル: LightGBM（全銘柄共通グローバルモデル）
- 重要度指標: feature importance (gain) — 分割による不純度減少への寄与合計
- 評価対象: 始値モデル・終値モデルそれぞれの gain における新特徴量の寄与率

---

## 既存特徴量（実装済み・継続使用）

| 特徴量 | 説明 | 始値gain寄与 | 終値gain寄与 |
|--------|------|------------|------------|
| `mkt_return_1d/5d` | 市場平均リターン（当日・5日） | **24.3%** | **18.8%** |
| `beta_20d` | 市場ベータ（20日） | - | **9.1%** |
| `return_1d` | 前日リターン | 17.5% | 1.3% |
| `stoch_k/d` | ストキャスティクス | 10.2% | 2.8% |
| `willr` | Williams %R | 6.5% | 0.9% |
| `high_low_ratio` | 高値安値レンジ比 | 0.2% | 7.5% |
| `atr_ratio` | ATR比率 | 0.6% | 3.2% |
| `intraday_return` | 日中騰落率（始値→終値） | 0.4% | 2.6% |
| `sector_return_1d/5d` | セクター相対リターン | 0.1% | 5.3% |
| `rel_to_mkt_1d` | 市場超過リターン | - | 1.0% |
| `alpha_1d` | 残差アルファ（ベータ除去） | - | 1.0% |

---

## 新規実装特徴量の効果評価

### ◎ 有効（両モデルまたは主要モデルで寄与あり）

| 特徴量 | 説明 | 始値gain | 終値gain | 判定 |
|--------|------|---------|---------|------|
| `amihud` | Amihud非流動性（Gu et al. 2020 第3位因子） | 5.0% | 0.8% | ◎ 継続 |
| `amihud_20` | Amihud 20日移動平均 | 0.0% | 0.9% | ◎ 継続 |
| `body_ratio` | Alpha#101: 日中body比率 | 2.9% | 1.4% | ◎ 継続 |
| `max_ret_20d` | MAX効果: 過去20日最大リターン | 0.9% | 3.1% | ◎ 継続 |
| `min_ret_20d` | MIN効果: 過去20日最小リターン | 1.8% | 0.6% | ◎ 継続 |
| `gap_ratio_5d_mean` | 直近5日平均オーバーナイトギャップ | 0.8% | 0.6% | ○ 継続 |

### ○ 部分的有効（終値モデルのみ）

| 特徴量 | 説明 | 始値gain | 終値gain | 判定 |
|--------|------|---------|---------|------|
| `return_60d` | 60日中期モメンタム | 0.0% | 1.3% | ○ 継続 |
| `return_20d` | 20日中期モメンタム | 0.0% | 0.7% | ○ 継続 |
| `cs_rank_vol20` | 出来高20日クロスセクショナルランク | 0.0% | 1.6% | ○ 継続 |
| `cs_rank_amihud` | Amihudクロスセクショナルランク | 0.0% | 1.1% | ○ 継続 |
| `cs_rank_ret1d` | 1日リターンクロスセクショナルランク | 0.0% | 0.9% | ○ 継続 |
| `high_52w_ratio` | 52週高値からの距離 | 0.0% | 1.0% | ○ 継続 |
| `low_52w_ratio` | 52週安値からの距離 | 0.0% | 0.5% | ○ 継続 |
| `vol_price_div` | Alpha#12: 出来高-価格乖離 | 0.0% | 0.7% | ○ 継続 |
| `open_vol_corr_10` | Alpha#6: 始値-出来高10日相関 | 0.0% | 0.5% | △ 継続 |
| `macd_hist_change` | MACDヒストグラム変化量 | 0.0% | 0.4% | △ 継続 |
| `vol_regime` | ボラティリティレジーム（std5/std20） | 0.0% | 0.3% | △ 継続 |
| `cs_rank_ret20d` | 20日リターンクロスセクショナルランク | 0.0% | 0.3% | △ 継続 |
| `cs_rank_ret5d` | 5日リターンクロスセクショナルランク | 0.0% | 0.2% | △ 継続 |
| `cs_rank_volreg` | ボラレジームクロスセクショナルランク | 0.0% | 0.1% | △ 継続 |
| `ts_rank_low_9` | Alpha#4: 安値9日時系列ランク | 0.0% | 0.0% | ✗ **削除** |

### ✗ 無効（両モデルで gain=0）

| 特徴量 | 説明 | 理由 | 判定 |
|--------|------|------|------|
| `days_to_earnings` | 決算発表までの日数 | J-Quantsデータが25件のみ。ほぼ全銘柄が番兵値(999)で情報量ゼロ | ✗ **削除** |
| `near_earnings_flag` | 決算前後5営業日フラグ | 同上 | ✗ **削除** |

---

## 削除する特徴量（2026-02-26）

- `ts_rank_low_9` — 両モデルでgain=0
- `days_to_earnings` — データ不足（J-Quants 25件）で実質無効
- `near_earnings_flag` — 同上

---

## 今後の改善候補

### 米国市場動向の取り込み（始値精度向上）

始値は前日の米国市場・CME先物・ドル円レートに強く連動するため、
日本市場データのみでの予測には構造的限界がある。

候補データソース:
- S&P500 / NASDAQ 前日終値リターン (`^GSPC`, `^IXIC` via yfinance)
- CME日経先物の引値 (`NKD=F`)
- ドル円レート前日変化率 (`USDJPY=X`)
- VIX（恐怖指数）レベル (`^VIX`)

### 目的変数の変更: 日中騰落率の直接予測

現在: 始値予測 + 終値予測 → 差分で期待利益算出  
代替案: **日中騰落率 `(close - open) / open` を直接予測**

メリット:
- 始値の絶対水準予測が不要になる（最も難しい部分を回避）
- デイトレの実損益に直結する量を直接最大化できる
- 特徴量の設計がシンプルになる

デメリット:
- 始値の水準が分からないため必要資金の計算が前日終値ベースの近似になる
